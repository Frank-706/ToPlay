<?phpsession_start();include "config.php";  $CN = new mysqli($CONFIG["db-host"], $CONFIG["db-user"], $CONFIG["db-pswd"], $CONFIG["db-name"]);  if ($CN->connect_error)      die("Connection failed: " . $CN->connect_error);?><!DOCTYPE html><html><head><title>Login: UTENTI</title>        <meta charset="UTF-8">        <meta name="keywords" content="toplay, login, utenti">        <meta name="viewport" content="width=device-width, initial-scale=1.0">		<meta name="description" content="Pagina di login">        <meta http-equiv="X-UA-Compatible" content="ie=edge">        <style>            img {                float: right;            }        	body {                        	padding:10px;                background-color: grey;                  }        	.comando {            	width:50px;            	height:50px;            }            table{                margin: auto;                border: solid black;                width: 50%;                background-color: #62a0ff;                color:black;                border-style: ridge;            }            th {                background-color: #ffc753;            	color:#530053;                            }        </style>        <script>        	function ordina(pkf, pk_art, prezzo ) {	            	document.getElementById('cliente').value = pkf;    	        	document.getElementById('articolo').value = pk_art;                    document.getElementById('prezzo').value = prezzo;                    document.getElementById("carrello").submit();                return;            }            function carrello() {                    document.getElementById("add").submit();                return;            }        </script></head><body><?php/*if($_POST["chiusura"] == "logout"){    $mess = "Logout effettuato.";    unset($_SESSION["pkf"]);    session_destroy();  }*/    /*if(isset($_SESSION['pkf'])){      echo "<a href='http://frankmoses.altervista.org/wapp/toplay/carrello.php'><img class='comando' src='http://frankmoses.altervista.org/wapp/toplay/img/carrello.png'></a><br>";}*/?><h1>To Play: Login</h1><form action="" method="POST" id="carrello" name="carrello"><input type="hidden" id = "ordina" name = "ordina" value ="ordina">    <input type="hidden" id = "cliente" name = "cliente" value ="">    <input type="hidden" id = "articolo" name = "articolo" value ="">    <input type="hidden" id = "prezzo" name = "prezzo" value ="">    </form><?php     if($_POST["chiusura"] == "logout"){   echo "Logout effettuato.";   unset($_SESSION["pkf"]);   session_destroy(); } if ($_POST["azione"] == "accedi") {		    $sql="SELECT l.pk as 'pkf',l.nome as 'Nome' FROM tp_utenti l WHERE l.password = '".md5($_POST['pswd'])."' and l.email='".$_POST['ema']."' and l.is_enabled=1";   $RS = $CN->query($sql);     if($RS->num_rows==1){       $row = $RS->fetch_assoc();       $_SESSION['pkf']=$row['pkf'];       $_SESSION['ema']=$row['ema'];       if(isset($_SESSION['pkf'])){          $msg = "Benvenuto " . $row['Nome']." !";       }       //echo $msg.'<br>';  }  else{    $msg ="Accesso negato!";    //echo $msg.'<br>';   } } ?><?phpif(!isset($_SESSION['pkf'])){?><form action="" method="POST"><fieldset><legend>Inserimento dati:</legend><strong>Email:</strong> <input type="email" id='ema' name="ema" placeholder="email"><br><strong>Password:</strong> <input type="password" id='pswd' name="pswd" placeholder="password"><br><input type="submit"  id="azione" name="azione" value="accedi"> oppure <a href="registra.php"> clicca qui</a> per registrarti</fieldset></form><?php}?><?phpif(isset($_SESSION["pkf"])){?><form action='' method="GET" id="add" name="add"><input type="hidden" id='sezione' name="sezione" value="carrello"></form><a href="javascript:carrello()"><img class='comando' src='http://frankmoses.altervista.org/wapp/toplay/img/carrello.png'></a><br><form action='' method="POST"><br><br><strong>Ricerca: </strong> <input type='text' name='nome' id='nome' placeholder='categorie,articoli,...'> <input type='submit' name="azione2" id="azione2" value='Ricerca'> <br><input type="submit" id="chiusura" name="chiusura" value="logout"><?php}?></form><?phpif($_POST['ordina']=='ordina'){   $utente=$_POST['cliente'];  $art=$_POST["articolo"];  $prezzo=$_POST["prezzo"];  $sql=" INSERT INTO tp_carrelli(`pk`, `fk_utenti`, `fk_articoli`, `qta`, `dt`,`prezzo_vend`) values(null,$utente, $art, 1, unix_timestamp(now()), $prezzo)";  echo $sql;  $CN->query($sql);  $sql = "SELECT max(nro) as 'num' FROM tp_ordini ";$result = $CN->query($sql);$row = $result->fetch_assoc();$nro = $row['num'];  $nro++;  $sql=" INSERT INTO tp_ordini(`pk`, `fk_utenti`, `nro`, `is_annullato`, `dt`) values(null,$utente,$nro, 0, unix_timestamp(now()))";  $CN->query($sql);  echo $sql;} if ($_POST["azione2"] == "Ricerca")    {    $tipo = $_POST["nome"];    //$select = $_POST["filtro"];    /*echo $select;    echo $tipo;*/    $sql = "            SELECT   a.pk as 'Id', c.nome as 'Categoria',            a.codice as 'Code',             s.nome as 'SottoCategoria',             a.nome as 'Articoli',             a.prezzo_cata as 'Prezzo',            a.descrizione as 'Descrizione',            a.qta as 'Quantità'            FROM tp_articoli a             join tp_sottocategorie s on a.fk_sottocategorie = s.pk             join tp_categorie c on s.fk_categorie = c.pk             where a.qta > 0             and a.is_visibile=1             and s.is_visibile=1            and c.is_visibile=1              and (a.codice like '%$tipo%' OR c.nome like '%$tipo%'                     or s.nome like '%$tipo%'                    or a.nome like '%$tipo%')             order by c.nome, s.nome";        }        else             $sql = "                    SELECT                     a.pk as 'Id',                    a.codice as 'Code',                    c.nome as 'Categoria',                    a.descrizione as 'Descrizione',                    s.nome as 'SottoCategoria',                    a.nome as 'Articoli',                    a.prezzo_cata as 'Prezzo',                    a.qta as 'Quantità'                    FROM tp_articoli a                    join tp_sottocategorie s on a.fk_sottocategorie = s.pk                    join tp_categorie c on s.fk_categorie = c.pk                    where a.qta > 0 and a.is_visibile=1                    and s.is_visibile=1                    and c.is_visibile=1                      order by c.nome, s.nome ";         $result = $CN->query($sql);            if ($result->num_rows > 0)             {            echo "<table border='2'>";            echo "<tr>";            echo "<th>Categoria</th>";            echo "<th>Sotto Categoria</th>";            echo "<th>Codice</th>";            echo "<th>Articoli</th>";            echo "<th>Prezzo</th>";            echo "<th>Quantit&agrave;</th>";            echo "<th>Descrizione</th>";            echo "<th>Immagini</th>";            if(isset($_SESSION['pkf'])){                echo "<th>Carrello</th>";               // echo "<th>Quanti articoli?</th>";            }            echo "</tr>";         while($row = $result->fetch_assoc()) {            echo "<input type='hidden' id='carrello' name='carrello' value='ordina'>";        	setlocale(LC_MONETARY, 'it_IT');            $pk=$row['Id'];            $prezzo=$row['Prezzo'];            echo "<tr>\n";                echo "<td align='center'>".$row["Categoria"]."</td>\n";                echo "<td align='center'>".$row["SottoCategoria"]."</td>\n";                echo "<td align='center'>".$row["Code"]."</td>\n";                echo "<td align='center'>".$row["Articoli"]."</td>\n";                echo "<td align='center'>". money_format('%.2n',$row["Prezzo"]).'€'."</td>\n";                echo "<td align='center'>".$row["Quantità"]."</td>\n";                echo "<td align='center'>".$row["Descrizione"]."</td>\n";               echo "<td align='center'>" . "<a href='http://frankmoses.altervista.org/wapp/toplay/img/upload/articolo_$pk.png'> "."<img class='comando' src='img/upload/articolo_$pk.png'></a>"."</td>";            if(isset($_SESSION["pkf"]))            {              //  echo "<td align='center'><input type='number' id='qta_ordine' name='qta_ordine' min=1></td>";            echo "<td align='center'>\n";        	echo "<a href=\"javascript:ordina('".$_SESSION["pkf"]."','".$pk."','".$row["Prezzo"]."')\">\n";	// occhio a ' e " -> inoltre \" è l'escaping di "         		echo "<img class='comando' src='http://frankmoses.altervista.org/wapp/toplay/img/carrello.png'>\n";        	echo "</a>\n";        echo "</td>\n";           }        echo "</tr>";           // echo "</tr>";        }        echo "</table><br>";        //echo $msg;    }     else {            echo "Nessun risultato";        }if($_GET['sezione']=='carrello'){    if(isset($_SESSION["pkf"]))    {        include("carrello.php");    }}?></body></html> 